
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>gps2net &#8212; gps2net 1.1.2020 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">gps2net 1.1.2020 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for gps2net</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">LineString</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">LineString</span>
<span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">timeit</span> <span class="k">import</span> <span class="n">default_timer</span> <span class="k">as</span> <span class="n">timer</span>
<span class="kn">import</span> <span class="nn">doctest</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="c1"># global variable: empty Directed Graph</span>
<span class="n">DG</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>


<div class="viewcode-block" id="blockPrint"><a class="viewcode-back" href="../index.html#gps2net.blockPrint">[docs]</a><span class="k">def</span> <span class="nf">blockPrint</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;This method is used to disable print() messages.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="enablePrint"><a class="viewcode-back" href="../index.html#gps2net.enablePrint">[docs]</a><span class="k">def</span> <span class="nf">enablePrint</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;This method restores print() messages. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">__stdout__</span></div>


<span class="c1"># Print iterations progress</span>
<div class="viewcode-block" id="printProgressBar"><a class="viewcode-back" href="../index.html#gps2net.printProgressBar">[docs]</a><span class="k">def</span> <span class="nf">printProgressBar</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">total</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;█&#39;</span><span class="p">,</span> <span class="n">printEnd</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Call in a loop to create terminal progress bar.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iteration : int</span>
<span class="sd">        current iteration</span>
<span class="sd">    total : Int</span>
<span class="sd">        total iterations</span>
<span class="sd">    prefix : str, optional</span>
<span class="sd">        prefix string, by default &#39;&#39;</span>
<span class="sd">    suffix : str, optional</span>
<span class="sd">        suffix string, by default &#39;&#39;</span>
<span class="sd">    decimals : int, optional</span>
<span class="sd">        positive number of decimals in percent complete, by default 1</span>
<span class="sd">    length : int, optional</span>
<span class="sd">        character length of bar, by default 100</span>
<span class="sd">    fill : str, optional</span>
<span class="sd">        bar fill character, by default &#39;█&#39;</span>
<span class="sd">    printEnd : str, optional</span>
<span class="sd">        end character (e.g. &#39;\\r&#39;, &#39;\\r\\n&#39;), by default &#39;\\r&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">percent</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;{0:.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">decimals</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span>
                                                     <span class="p">(</span><span class="n">iteration</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total</span><span class="p">)))</span>
    <span class="n">filledLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span> <span class="o">*</span> <span class="n">iteration</span> <span class="o">//</span> <span class="n">total</span><span class="p">)</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fill</span> <span class="o">*</span> <span class="n">filledLength</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="n">filledLength</span><span class="p">)</span>

    <span class="c1"># enablePrint()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r</span><span class="si">%s</span><span class="s1"> |</span><span class="si">%s</span><span class="s1">| </span><span class="si">%s%%</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">bar</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">suffix</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="n">printEnd</span><span class="p">)</span>
    <span class="c1"># Print New Line on Complete</span>
    <span class="k">if</span> <span class="n">iteration</span> <span class="o">==</span> <span class="n">total</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">()</span></div>

    <span class="c1"># blockPrint()</span>


<div class="viewcode-block" id="distFrom"><a class="viewcode-back" href="../index.html#gps2net.distFrom">[docs]</a><span class="k">def</span> <span class="nf">distFrom</span><span class="p">(</span><span class="n">lng1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">lng2</span><span class="p">,</span> <span class="n">lat2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the distance between two points in meters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lng1 : float</span>
<span class="sd">        This float is the longitude of the source.</span>
<span class="sd">    lat1 : float</span>
<span class="sd">        This float is the latitude of the source.</span>
<span class="sd">    lng2 : float</span>
<span class="sd">        This float is the longitude of the target.</span>
<span class="sd">    lat2 : float</span>
<span class="sd">        This float is the latitude of the target.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function calculates the distance between two gps points.</span>
<span class="sd">    The result is not 100% correct as the function does not consider the elipsis-like shape of the earth. Instead it just uses an earth radius of 6371000 meters for the calculation.</span>

<span class="sd">    A more accurate calculation of the distance can be done in QGIS. For more details, please visit: http://www.qgistutorials.com/en/docs/calculating_line_lengths.html</span>
<span class="sd">    However, this function was used to be able to run the code independently of QGIS.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; x=12</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    12</span>
<span class="sd">    &gt;&gt;&gt; (5&lt;10)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; myDist = distFrom(-122.115, 37.115, -122.111, 37.111)</span>
<span class="sd">    &gt;&gt;&gt; myDist</span>
<span class="sd">    568.8872918546489</span>
<span class="sd">    &gt;&gt;&gt; distFrom(-122.115, 37.115, -122.111, 37.111) # doctest: +SKIP</span>
<span class="sd">    5</span>


<span class="sd">    Returns</span>
<span class="sd">    --------</span>
<span class="sd">    dist : int</span>
<span class="sd">        The distance between two points in meters.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">earthRadius</span> <span class="o">=</span> <span class="mi">6371000</span>  <span class="c1"># meters</span>
    <span class="n">dLat</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="o">-</span><span class="n">lat1</span><span class="p">)</span>
    <span class="n">dLng</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lng2</span><span class="o">-</span><span class="n">lng1</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dLat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dLat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">))</span> <span class="o">*</span> \
        <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">))</span> <span class="o">*</span> \
        <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dLng</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">dLng</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">))</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">earthRadius</span> <span class="o">*</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">dist</span></div>


<div class="viewcode-block" id="cut"><a class="viewcode-back" href="../index.html#gps2net.cut">[docs]</a><span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Cuts a line in two at a distance from its starting point.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    line : Shapely &#39;LineString&#39; object</span>
<span class="sd">        [description]</span>
<span class="sd">    distance : float</span>
<span class="sd">        [description]</span>
<span class="sd">    point : Shapely Point object</span>
<span class="sd">        [description]</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    ...</span>
<span class="sd">    &#39;line.interpolate(distance)&#39; should be equal to the parameter &#39;point&#39;. However, due to precision errors &#39;point&#39; is used.</span>
<span class="sd">    ...</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list with LineStrings</span>
<span class="sd">        Two LineStrings are returned. &#39;point&#39; is the end point of the first LineString and the start point of the second LineString.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># check if point lies on line. If not, return uncut line.</span>
    <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="n">line</span><span class="o">.</span><span class="n">length</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">LineString</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

    <span class="c1"># loop through all all points (nodes) of the linestring</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
        <span class="c1"># i is the index</span>
        <span class="c1"># p is the point on the line</span>
        <span class="c1"># pd is the distance of point p on the line</span>
        <span class="n">pd</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="c1"># pd==distance means that point where the line should be cut is already a point on the line at index i (= so this means that there is a linesegment in the line which has the point as a starting or end point)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pd</span> <span class="o">==</span> <span class="n">distance</span><span class="p">):</span>
            <span class="c1"># return two lines (whithout cutting any line segment)</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">LineString</span><span class="p">(</span><span class="n">coords</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">LineString</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">:])]</span>
        <span class="c1"># pd&gt;distance means that a line segment of the line has to be cut</span>
        <span class="c1"># If the line is a circle (start of the line equals the end of the line) and the line has to be cut in the last line segment &#39;pd&gt;distance&#39; is not enough as pd=0.0 for the end point.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pd</span> <span class="o">&gt;</span> <span class="n">distance</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">pd</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">coords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">coords</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
            <span class="c1"># return the cut line</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">LineString</span><span class="p">(</span><span class="n">coords</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">[(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">)]),</span>
                <span class="n">LineString</span><span class="p">([(</span><span class="n">point</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">point</span><span class="o">.</span><span class="n">y</span><span class="p">)]</span> <span class="o">+</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">:])]</span></div>


<div class="viewcode-block" id="createGraphFromSHPInput"><a class="viewcode-back" href="../index.html#gps2net.createGraphFromSHPInput">[docs]</a><span class="k">def</span> <span class="nf">createGraphFromSHPInput</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Creates a directed graph from a shp file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath_shp : str</span>
<span class="sd">        The path where the shp file (which contains the street data) is stored.</span>


<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This graph is only initialized once in the beginning of the script. The DiGraph contains all linesegment of the shp file as directed edges. The start and end node of each edge are tuples containing the coordinates of the position. The weight of an edge is the air_line_distance from the start to the end of the linesegment. Each edge containes the following attributes:</span>
<span class="sd">    </span>
<span class="sd">    - id : int</span>
<span class="sd">        The id of the street (LineString) which the linesegment belongs to according to the shapefile.</span>
<span class="sd">    - oneway : {&#39;B&#39;, &#39;F&#39;, &#39;T&#39;}</span>
<span class="sd">        The &#39;oneway&#39;-property of the street (LineString) which the linesegment belongs to according to the shapefile. The &#39;oneway&#39;-property indicates if a street is bi-directional (B), or one way heading from the from-node to the to-node (F), or one way heading from the to-node to the from-node (T).</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Directed Graph</span>
<span class="sd">        The Directed Graph which contains all linesegments of the shapefiles as edges is returned.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">GraphFromSHP</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>

    <span class="c1"># blockPrint()</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Graph already exists&#39;</span><span class="p">)</span>

    <span class="n">nr_elements_in_SHP_file</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_lines</span><span class="p">:</span>
        <span class="n">nr_elements_in_SHP_file</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_lines</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nr_elements_in_SHP_file: &#39;</span><span class="p">,</span> <span class="n">nr_elements_in_SHP_file</span><span class="p">)</span>

    <span class="c1"># Initial call to print 0% progress ProgressBar</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;| SHP file items: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nr_elements_in_SHP_file</span><span class="p">)</span>
    <span class="n">printProgressBar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nr_elements_in_SHP_file</span><span class="p">,</span>
                     <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Creating Graph:&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="c1"># print(&#39;graph nr of edges: &#39;, GraphFromSHP.number_of_edges())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;starting to build graph: &#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_lines</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_lines</span><span class="p">):</span>
            <span class="n">counter_inner</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">previous_coord</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">oneway</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;oneway&#39;</span><span class="p">]</span>

            <span class="c1"># print(&#39;id: &#39;, id)</span>
            <span class="c1"># print(&#39;oneway: &#39;, oneway)</span>

            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">]:</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">previous_coord</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="c1"># print(&#39;previous_coord: &#39;, previous_coord)</span>
                    <span class="c1"># print(&#39;coord: &#39;, coord)</span>

                    <span class="n">calculated_length</span> <span class="o">=</span> <span class="n">distFrom</span><span class="p">(</span>
                        <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">previous_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">previous_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="k">if</span><span class="p">(</span><span class="n">oneway</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">):</span>
                        <span class="c1"># create two directed edges for both directions</span>
                        <span class="n">GraphFromSHP</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                            <span class="n">coord</span><span class="p">,</span> <span class="n">previous_coord</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">calculated_length</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">oneway</span><span class="o">=</span><span class="n">oneway</span><span class="p">)</span>
                        <span class="n">GraphFromSHP</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                            <span class="n">previous_coord</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">calculated_length</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">oneway</span><span class="o">=</span><span class="n">oneway</span><span class="p">)</span>
                    <span class="k">elif</span><span class="p">(</span><span class="n">oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
                        <span class="c1"># create a directed edge from the from-node to the to-node</span>
                        <span class="n">GraphFromSHP</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                            <span class="n">previous_coord</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">calculated_length</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">oneway</span><span class="o">=</span><span class="n">oneway</span><span class="p">)</span>
                    <span class="k">elif</span><span class="p">(</span><span class="n">oneway</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">):</span>
                        <span class="c1"># create a directed edge from the to-node to the from-node</span>
                        <span class="n">GraphFromSHP</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span>
                            <span class="n">coord</span><span class="p">,</span> <span class="n">previous_coord</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">calculated_length</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">oneway</span><span class="o">=</span><span class="n">oneway</span><span class="p">)</span>

                <span class="c1"># else:</span>
                    <span class="c1"># print(&#39;revious_coord    ==    (0,0)   --------------&#39;)</span>

                <span class="c1"># print(counter_inner)</span>
                <span class="n">counter_inner</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">previous_coord</span> <span class="o">=</span> <span class="n">coord</span>

            <span class="c1"># enablePrint()</span>

            <span class="c1"># Update Progress Bar</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;| SHP file items: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">nr_elements_in_SHP_file</span><span class="p">)</span>
            <span class="n">printProgressBar</span><span class="p">(</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nr_elements_in_SHP_file</span><span class="p">,</span>
                             <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Creating Graph:&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

            <span class="c1"># blockPrint()</span>

            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># enablePrint()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;graph nr of edges AFTER CREATION: &#39;</span><span class="p">,</span> <span class="n">GraphFromSHP</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">())</span>

    <span class="c1"># blockPrint()</span>

    <span class="c1"># print(&#39;GraphFromSHP: &#39;, (GraphFromSHP.edges(data=True)))</span>

    <span class="c1"># enablePrint()</span>

    <span class="c1"># print(&#39;graph nr of edges: &#39;, GraphFromSHP.number_of_edges())</span>

    <span class="c1"># blockPrint()</span>

    <span class="k">return</span> <span class="n">GraphFromSHP</span></div>


<span class="c1"># %%</span>

<span class="k">def</span> <span class="nf">getShortestPathAStar</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source_line</span><span class="p">,</span> <span class="n">target_line</span><span class="p">,</span> <span class="n">source_line_oneway</span><span class="p">,</span> <span class="n">target_line_oneway</span><span class="p">,</span> <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">ignore_oneway</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="c1"># make sure global variable is used. &#39;DG&#39; is a Directed Graph</span>
    <span class="k">global</span> <span class="n">DG</span>

    <span class="c1"># blockPrint()</span>

    <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">path_length</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">path_IDs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_added_edges</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">air_line_distance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Heuristic function for A star algorithm: returns the air line distance from the source to the target.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        source : tuple (float, float)</span>
<span class="sd">            This is the source point. It is a tuple of the form (lng1, lat1) where lng1 is the longitude of the source and lat1 is the latitude of the source.</span>
<span class="sd">        target : tuple (float, float)</span>
<span class="sd">            This is the source point. It is a tuple of the form (lng2, lat2) where lng2 is the longitude of the target and lat2 is the latitude of the target.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function is used as the heuristic function for the A Star algorithm.</span>
<span class="sd">        It calculates the air line distance between two gps points.</span>
<span class="sd">        The result is not 100% correct as the function does not consider the elipsis-like shape of the earth. Instead it just uses an earth radius of 6371000 meters for the calculation.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; myAirLineDist = distFrom((-122.115, 37.115), (-122.111, 37.111))</span>
<span class="sd">        &gt;&gt;&gt; myAirLineDist</span>
<span class="sd">        568.8872918546489</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The air line distance between two points (source and target) in meters.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">distFrom</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">distance</span>

    <span class="k">def</span> <span class="nf">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">startNode</span><span class="p">,</span> <span class="n">endNode</span><span class="p">,</span> <span class="n">edgeWeight</span><span class="p">,</span> <span class="n">edgeId</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Temporarily adds an edge to the global graph.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        startNode : tuple (float, float)</span>
<span class="sd">            [description]</span>
<span class="sd">        endNode : tuple (float, float)</span>
<span class="sd">            [description]</span>
<span class="sd">        edgeWeight : int</span>
<span class="sd">            The edgeweight is the distance between the startNode and the endNode in meters.</span>
<span class="sd">        edgeId : int</span>
<span class="sd">            The id of the street (LineString) which the linesegment belongs to according to the shapefile.</span>
<span class="sd">        direction : {&#39;B&#39;, &#39;F&#39;, &#39;T&#39;}</span>
<span class="sd">            The &#39;oneway&#39;-property of the street (LineString) which the linesegment belongs to according to the shapefile.</span>
<span class="sd">            The &#39;oneway&#39;-property indicates if a street is bi-directional (B), or one way heading from the from-node to the to-node (F), or one way heading from the to-node to the from-node (T).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This function temporarily adds an edge to the global graph. It only adds the edge if it deosn&#39;t exist in the graph yet. Further, the new edge is added to the list &#39;all_added_edges&#39; so that it can be removed again in the end.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">DG</span><span class="o">.</span><span class="n">has_edge</span><span class="p">(</span><span class="n">startNode</span><span class="p">,</span> <span class="n">endNode</span><span class="p">)):</span>
            <span class="c1"># print(&#39;edge has to be added&#39;)</span>
            <span class="c1"># print(&#39;adding ({},{})&#39;.format(startNode, endNode))</span>
            <span class="c1"># print(&#39;&#39;)</span>

            <span class="n">DG</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">startNode</span><span class="p">,</span> <span class="n">endNode</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">edgeWeight</span><span class="p">,</span>
                        <span class="nb">id</span><span class="o">=</span><span class="n">edgeId</span><span class="p">,</span> <span class="n">oneway</span><span class="o">=</span><span class="n">direction</span><span class="p">)</span>
            <span class="n">all_added_edges</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">startNode</span><span class="p">,</span> <span class="n">endNode</span><span class="p">))</span>
        <span class="c1"># else:</span>
            <span class="c1"># print(&#39;graph does have({},{})&#39;.format(startNode,endNode))</span>
            <span class="c1"># print(&#39;edge:&#39;,DG.get_edge_data(startNode, endNode))</span>
            <span class="c1"># print(&#39;&#39;)</span>

    <span class="c1"># check if the global variable &#39;DG&#39; is an empty directed graph. If yes, create a graph from the shp-file content.</span>
    <span class="k">if</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">is_empty</span><span class="p">(</span><span class="n">DG</span><span class="p">)):</span>
        <span class="n">DG</span> <span class="o">=</span> <span class="p">(</span><span class="n">createGraphFromSHPInput</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">))</span>

    <span class="c1"># check if target lies exactly on the beginning/end of a line segment</span>
    <span class="c1"># if yes, target already exists as a node</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_line</span><span class="p">):</span>
        <span class="c1"># remove the target_line edges and add the line_segments as edges</span>

        <span class="n">d_target</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">target_line</span><span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

        <span class="n">cut_line_target</span> <span class="o">=</span> <span class="n">cut</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">target_line</span><span class="p">),</span> <span class="n">d_target</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
        <span class="c1"># print(&#39;cut_line_target: &#39;, cut_line_target)</span>
        <span class="n">new_line_target_after_cut</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cut_line_target</span><span class="p">]</span>

        <span class="n">len_line_segment</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_line_target_after_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">edge_to_remove_T_source</span> <span class="o">=</span> <span class="n">new_line_target_after_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">len_line_segment</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">edge_to_remove_T_target</span> <span class="o">=</span> <span class="n">new_line_target_after_cut</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># get the edge (including the attributes) that should be removed from the graph</span>

        <span class="k">if</span><span class="p">(</span><span class="n">target_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">):</span>
            <span class="n">edge_to_remove_from_graph</span> <span class="o">=</span> <span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_source</span><span class="p">,</span> <span class="n">edge_to_remove_T_target</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B:&#39;</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">target_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
            <span class="n">edge_to_remove_from_graph</span> <span class="o">=</span> <span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_source</span><span class="p">,</span> <span class="n">edge_to_remove_T_target</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;F:&#39;</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">target_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">):</span>
            <span class="n">edge_to_remove_from_graph</span> <span class="o">=</span> <span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_target</span><span class="p">,</span> <span class="n">edge_to_remove_T_source</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;T:&#39;</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph</span><span class="p">)</span>

        <span class="n">edge_to_remove_from_graph_id</span> <span class="o">=</span> <span class="n">edge_to_remove_from_graph</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">edge_to_remove_from_graph_oneway</span> <span class="o">=</span> <span class="n">edge_to_remove_from_graph</span><span class="p">[</span><span class="s1">&#39;oneway&#39;</span><span class="p">]</span>

        <span class="c1"># add the line segments for the target</span>

        <span class="k">if</span><span class="p">(</span><span class="n">edge_to_remove_from_graph_oneway</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span> <span class="ow">or</span> <span class="n">ignore_oneway</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>

            <span class="c1"># add edges in direction of from-node to to-node</span>

            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_T_source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">edge_to_remove_T_target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="c1"># add edges in direction of to-node to from-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_T_target</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">edge_to_remove_T_source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">edge_to_remove_from_graph_oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
            <span class="c1"># add edges in direction of from-node to to-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_T_source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">edge_to_remove_T_target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># add edges in direction of to-node to from-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">edge_to_remove_T_source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_T_target</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_T_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no need to add additional edges target&#39;</span><span class="p">)</span>

    <span class="c1"># check if source lies exactly on the beginning/end of a line segment</span>
    <span class="c1"># if yes, source already exists as a node</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_line</span><span class="p">):</span>
        <span class="c1"># remove the source_line edges and add the line_segments as edges</span>

        <span class="c1"># if source and target line are equal, the already cut line has to be used</span>

        <span class="n">d_source</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">source_line</span><span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="n">cut_line_source</span> <span class="o">=</span> <span class="n">cut</span><span class="p">(</span><span class="n">LineString</span><span class="p">(</span><span class="n">source_line</span><span class="p">),</span> <span class="n">d_source</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="n">new_line_source_after_cut</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cut_line_source</span><span class="p">]</span>

        <span class="n">len_line_segment</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_line_source_after_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">edge_to_remove_S_source</span> <span class="o">=</span> <span class="n">new_line_source_after_cut</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">len_line_segment</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">edge_to_remove_S_target</span> <span class="o">=</span> <span class="n">new_line_source_after_cut</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># get the edge (including the attributes) that should be removed from the graph</span>

        <span class="k">if</span><span class="p">(</span><span class="n">source_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">):</span>
            <span class="n">edge_to_remove_from_graph</span> <span class="o">=</span> <span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_source</span><span class="p">,</span> <span class="n">edge_to_remove_S_target</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">source_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
            <span class="n">edge_to_remove_from_graph</span> <span class="o">=</span> <span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_source</span><span class="p">,</span> <span class="n">edge_to_remove_S_target</span><span class="p">)</span>

        <span class="k">elif</span><span class="p">(</span><span class="n">source_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">):</span>
            <span class="n">edge_to_remove_from_graph</span> <span class="o">=</span> <span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_target</span><span class="p">,</span> <span class="n">edge_to_remove_S_source</span><span class="p">)</span>

        <span class="n">edge_to_remove_from_graph_id</span> <span class="o">=</span> <span class="n">edge_to_remove_from_graph</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
        <span class="n">edge_to_remove_from_graph_oneway</span> <span class="o">=</span> <span class="n">edge_to_remove_from_graph</span><span class="p">[</span><span class="s1">&#39;oneway&#39;</span><span class="p">]</span>

        <span class="c1"># if source and target line on the same line segment, add a connection between the two</span>
        <span class="k">if</span><span class="p">((</span><span class="n">source_line</span> <span class="o">==</span> <span class="n">target_line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">target</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">edge_to_remove_T_source</span> <span class="o">==</span> <span class="n">edge_to_remove_S_source</span><span class="p">)</span><span class="ow">and</span> <span class="p">(</span><span class="n">edge_to_remove_T_target</span> <span class="o">==</span> <span class="n">edge_to_remove_S_target</span><span class="p">)):</span>

            <span class="c1"># check which point comes first on the line to then know which direction the line between the two should be</span>
            <span class="n">d_target_same_line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">source_line</span><span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
            <span class="n">d_source_same_line</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">source_line</span><span class="p">)</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>

            <span class="c1"># get the edge (including the attributes) that should be removed from the graph</span>

            <span class="k">if</span><span class="p">(</span><span class="n">source_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span> <span class="ow">or</span> <span class="n">ignore_oneway</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
                <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                    <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
                <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                    <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

            <span class="k">elif</span><span class="p">(</span><span class="n">source_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
                <span class="c1"># if the source_line (which equals target_line) is onway from the from-node to the to-node, the point which is closer at the beginning of the line has to be the starting point of the directed edge which is added to the graph</span>
                <span class="k">if</span><span class="p">(</span><span class="n">d_source_same_line</span> <span class="o">&gt;</span> <span class="n">d_target_same_line</span><span class="p">):</span>
                    <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                        <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                        <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

            <span class="k">elif</span><span class="p">(</span><span class="n">source_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">):</span>
                <span class="c1"># if the source_line (which equals target_line) is oneway from the to-node to the from-node, the point which is closer at the end of the line has to be the starting point of the directed edge which is added to the graph</span>
                <span class="k">if</span><span class="p">(</span><span class="n">d_source_same_line</span> <span class="o">&gt;</span> <span class="n">d_target_same_line</span><span class="p">):</span>
                    <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                        <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                        <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

        <span class="c1"># add the line segments for the source</span>
        <span class="k">if</span><span class="p">(</span><span class="n">edge_to_remove_from_graph_oneway</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span> <span class="ow">or</span> <span class="n">ignore_oneway</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
            <span class="c1"># add edges in direction of from-node to to-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_S_source</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">edge_to_remove_S_target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="c1"># add edges in direction of to-node to from-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_S_target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">edge_to_remove_S_source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
        <span class="k">elif</span><span class="p">(</span><span class="n">edge_to_remove_from_graph_oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">):</span>
            <span class="c1"># add edges in direction of from-node to to-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_S_source</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">edge_to_remove_S_target</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># add edges in direction of to-node to from-node</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">edge_to_remove_S_target</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_target</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>
            <span class="n">temporarily_add_edge_to_graph</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">edge_to_remove_S_source</span><span class="p">,</span> <span class="n">distFrom</span><span class="p">(</span>
                <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_to_remove_S_source</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">edge_to_remove_from_graph_id</span><span class="p">,</span> <span class="n">edge_to_remove_from_graph_oneway</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>

        <span class="c1"># try to find a path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">astar_path</span><span class="p">(</span><span class="n">DG</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                             <span class="n">heuristic</span><span class="o">=</span><span class="n">air_line_distance</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span>

        <span class="n">path_length</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">astar_path_length</span><span class="p">(</span>
            <span class="n">DG</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">heuristic</span><span class="o">=</span><span class="n">air_line_distance</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span>

        <span class="c1"># get the IDs of the traversed lines</span>
        <span class="n">prevNode</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">prevNode</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>

                <span class="k">if</span><span class="p">(</span><span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">prevNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="c1"># get id of edge</span>
                    <span class="n">path_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DG</span><span class="o">.</span><span class="n">get_edge_data</span><span class="p">(</span><span class="n">prevNode</span><span class="p">,</span> <span class="n">node</span><span class="p">)[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># edge was not found</span>
                    <span class="n">path_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;edge not found! -- prevNode:&#39;</span><span class="p">,</span> <span class="n">prevNode</span><span class="p">)</span>
                    <span class="n">path_IDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;edge not found! -- node:&#39;</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
            <span class="n">prevNode</span> <span class="o">=</span> <span class="n">node</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># no path was found</span>
        <span class="k">pass</span>

    <span class="c1"># remove all the edges which where added to the graph.</span>
    <span class="n">DG</span><span class="o">.</span><span class="n">remove_edges_from</span><span class="p">(</span><span class="n">all_added_edges</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">path_length</span><span class="p">,</span> <span class="n">path_IDs</span>


<span class="c1"># %%</span>


<div class="viewcode-block" id="calculateClosestPointAndShortestPath"><a class="viewcode-back" href="../index.html#gps2net.calculateClosestPointAndShortestPath">[docs]</a><span class="k">def</span> <span class="nf">calculateClosestPointAndShortestPath</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">minNumberOfLines</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">aStar</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;[summary]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filepath : str</span>
<span class="sd">        The path where the txt file (which contains the gps trajectories) is stored.</span>
<span class="sd">    filepath_shp : str</span>
<span class="sd">        The path where the shp file (which contains the street data) is stored.</span>
<span class="sd">    minNumberOfLines : int, optional</span>
<span class="sd">        [description], by default 2</span>
<span class="sd">    aStar : int, optional</span>
<span class="sd">        [description], by default 1</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>


<span class="sd">    - outlier : Number of data points which where flagged as outliers.</span>
<span class="sd">    - taxi_did_not_move : x</span>
<span class="sd">    - no_path_found : </span>
<span class="sd">    - cannot_compute_shortest_path_as_previous_point_is_0_0 : </span>
<span class="sd">    - path_from_target_to_source : </span>
<span class="sd">    - checked_other_solution_index : </span>
<span class="sd">    - chose_other_solution_index : </span>
<span class="sd">    - solution_already_lies_on_shortest_path : </span>
<span class="sd">    - no_solution_lies_on_shortest_path : </span>
<span class="sd">    - other_solution_is_worse : </span>
<span class="sd">    - other_solution_no_path_found : </span>



<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    calculatedSolution : list</span>


<span class="sd">    statistics : list</span>
<span class="sd">        Statistics for the txt file (containing gps trajectories) for which the solution is calculated.</span>
<span class="sd">        The statistics contain the following numbers (all of type int):</span>

<span class="sd">        - outlier : Number of data points which where flagged as outliers.</span>
<span class="sd">        - taxi_did_not_move : Number of times when a data point&#39;s gps position was identical to the gps position of the previous data point.</span>
<span class="sd">        - no_path_found : Number of times no path was found with the A Star algorithm. </span>
<span class="sd">        - cannot_compute_shortest_path_as_previous_point_is_0_0 : </span>
<span class="sd">        - path_from_target_to_source : </span>
<span class="sd">        - checked_other_solution_index : </span>
<span class="sd">        - chose_other_solution_index : </span>
<span class="sd">        - solution_already_lies_on_shortest_path : </span>
<span class="sd">        - no_solution_lies_on_shortest_path : </span>
<span class="sd">        - other_solution_is_worse : </span>
<span class="sd">        - other_solution_no_path_found : </span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># blockPrint()</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">calculatedSolution</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># initialize the dict in which all the statistics of the currently calculated solution will be stored.</span>
    <span class="n">statistics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;outlier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;taxi_did_not_move&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;no_path_found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;cannot_compute_shortest_path_as_previous_point_is_0_0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;path_from_target_to_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;checked_other_solution_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;chose_other_solution_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;solution_already_lies_on_shortest_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;no_solution_lies_on_shortest_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;other_solution_is_worse&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;other_solution_no_path_found&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">previous_target</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">previous_source</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">previous_intersected_line</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">previous_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">previous_intersected_line_oneway</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">getLocationResult</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">passenger</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">previous_point</span><span class="p">,</span> <span class="n">previous_intersected_line</span><span class="p">,</span> <span class="n">previous_timestamp</span><span class="p">,</span> <span class="n">previous_intersected_line_oneway</span><span class="p">,</span> <span class="n">minNumberOfLines</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CHECKING ---------------------------&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">passenger</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">previous_point</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">previous_intersected_line</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">previous_timestamp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">previous_intersected_line_oneway</span><span class="p">)</span>

        <span class="n">location_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># all the paths who were not changed from source--&gt;target to target--&gt;source have the following property</span>
        <span class="n">path_from_target_to_source</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">closest_intersection_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">closest_intersection_y</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">intersected_line</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">intersected_line_oneway</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># set those key which are not necessarily set (e.g. when previous point was an outlier)</span>

        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;solution_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_point</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">previous_intersected_line</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;previous_intersected_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_intersected_line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;previous_intersected_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span><span class="p">(</span><span class="n">previous_intersected_line_oneway</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;previous_intersected_line_oneway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_intersected_line_oneway</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;previous_intersected_line_oneway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;air_line_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;pathIDs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_from_target_to_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;closest_intersection_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;closest_intersection_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;relative_position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;relative_position_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;intersected_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;intersected_line_oneway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;linestring_adjustment_visualization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;passenger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">passenger</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;previous_timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_timestamp</span>

        <span class="c1"># how to get the closest line from one point</span>

        <span class="n">focal_pt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># radial sweep centre point</span>

        <span class="c1"># load the input lines and combine them into one geometry</span>

        <span class="c1"># the whole san francisco shp file (which was exported as a copy)</span>
        <span class="c1"># TODO: write better comment like:  min nr just needed to increse areasize</span>
        <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_lines</span><span class="p">:</span>
            <span class="c1"># define size of area to filter map lines</span>
            <span class="n">areasize</span> <span class="o">=</span> <span class="mf">0.0005</span>
            <span class="n">max_areasize</span> <span class="o">=</span> <span class="mf">0.001</span>
            <span class="n">number_of_lines</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># define number of lines which have to be looked at after filter</span>
            <span class="k">while</span> <span class="p">((</span><span class="n">number_of_lines</span> <span class="o">&lt;</span> <span class="n">minNumberOfLines</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">areasize</span> <span class="o">&lt;</span> <span class="n">max_areasize</span><span class="p">)):</span>

                <span class="n">input_shapes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_lines</span><span class="o">.</span><span class="n">items</span><span class="p">(</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">areasize</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">areasize</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">areasize</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="o">+</span><span class="n">areasize</span><span class="p">))))</span>

                <span class="n">number_of_lines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_shapes</span><span class="p">)</span>

                <span class="c1"># double are size so that if no lines are found, a bigger area is taken into account when filtering</span>
                <span class="n">areasize</span> <span class="o">=</span> <span class="n">areasize</span><span class="o">*</span><span class="mf">1.25</span>

                <span class="c1"># if the areasize already arrived at its maximuum size decrease the set minimum number of lines by one.</span>
                <span class="c1"># This makes sure that (if minNumberOfLines&gt;1) a point is only market as an outlier if there is not even one line within the aresize.</span>
                <span class="c1"># Without that it is possible that points are market as outliers just because there are not many lines close to the point,</span>
                <span class="c1"># even though the point lies very close to a line.</span>

                <span class="c1"># if((not (number_of_lines &lt; minNumberOfLines)) and (not (areasize &lt; max_areasize)) and (minNumberOfLines &gt; 1)):</span>
                <span class="c1">#    minNumberOfLines -= 1</span>

        <span class="c1"># point is oulier only if no line was found</span>
        <span class="k">if</span><span class="p">(</span><span class="n">number_of_lines</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This point is an outlier.&#39;</span><span class="p">)</span>
            <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;This point is an outlier.&#39;</span>

            <span class="c1"># makes sure that next point doesn&#39;t calculate shortest path</span>
            <span class="n">previous_point</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># update statistics</span>
            <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;outlier&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># point is not an outlier</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">solution_dict</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">input_line</span> <span class="ow">in</span> <span class="n">input_shapes</span><span class="p">:</span>

                <span class="n">lineID</span> <span class="o">=</span> <span class="n">input_line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>

                <span class="n">newLS</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">input_line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;geometry&#39;</span><span class="p">][</span><span class="s1">&#39;coordinates&#39;</span><span class="p">])</span>
                <span class="c1"># get the distance along the LineString to a point nearest to the point</span>
                <span class="n">relative_position</span> <span class="o">=</span> <span class="n">newLS</span><span class="o">.</span><span class="n">project</span><span class="p">(</span><span class="n">focal_pt</span><span class="p">)</span>
                <span class="c1"># get the distance normalized to the length of the LineString</span>
                <span class="n">relative_position_normalized</span> <span class="o">=</span> <span class="n">newLS</span><span class="o">.</span><span class="n">project</span><span class="p">(</span>
                    <span class="n">focal_pt</span><span class="p">,</span> <span class="n">normalized</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">closest_point_on_line</span> <span class="o">=</span> <span class="n">newLS</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">relative_position</span><span class="p">)</span>

                <span class="n">inter_dict_point</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">inter_dict_point</span><span class="p">[</span><span class="s1">&#39;closest_point_on_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest_point_on_line</span>
                <span class="n">inter_dict_point</span><span class="p">[</span><span class="s1">&#39;relative_position_closest_point_on_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative_position</span>
                <span class="n">inter_dict_point</span><span class="p">[</span><span class="s1">&#39;relative_position_normalized_closest_point_on_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative_position_normalized</span>
                <span class="n">inter_dict_point</span><span class="p">[</span><span class="s1">&#39;input_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newLS</span>

                <span class="n">inter_dict_point</span><span class="p">[</span><span class="s1">&#39;oneway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_line</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;oneway&#39;</span><span class="p">]</span>

                <span class="c1"># distance needs to be float so that it can be sorted appropriately afterwards</span>
                <span class="n">inter_dict_point</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                    <span class="n">focal_pt</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">closest_point_on_line</span><span class="p">))</span>

                <span class="n">solution_dict</span><span class="p">[</span><span class="n">lineID</span><span class="p">]</span> <span class="o">=</span> <span class="n">inter_dict_point</span>

            <span class="c1"># sort the nested dict by the &#39;distance&#39; which lies  within all the inner dicts</span>
            <span class="c1"># first element in the sorted dict is the point with the shortest distance to the focal_pt</span>
            <span class="n">solution_dict_sorted_by_distance</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="n">solution_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="p">(</span><span class="n">kv</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;distance&#39;</span><span class="p">]))</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;solution NEW:&#39;</span><span class="p">)</span>
            <span class="c1"># get the first element as it is the one with the smallest distance (which is the closest point)</span>
            <span class="n">solution_id</span> <span class="o">=</span> <span class="n">solution_dict_sorted_by_distance</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">solution</span> <span class="o">=</span> <span class="n">solution_dict_sorted_by_distance</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;all_solutions_sorted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution_dict_sorted_by_distance</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution_id</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;solution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span>

            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">solution</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="n">s</span><span class="p">]))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;end solution&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">closest_intersection_x</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;closest_point_on_line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
            <span class="n">closest_intersection_y</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;closest_point_on_line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">y</span>
            <span class="n">relative_position</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;relative_position_closest_point_on_line&#39;</span><span class="p">]</span>
            <span class="n">relative_position_normalized</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;relative_position_normalized_closest_point_on_line&#39;</span><span class="p">]</span>

            <span class="n">intersected_line</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;input_line&#39;</span><span class="p">]</span>
            <span class="n">intersected_line_oneway</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="s1">&#39;oneway&#39;</span><span class="p">]</span>

            <span class="c1"># when appending the solution we have to parse the floats into strings</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;closest_intersection_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest_intersection_x</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;closest_intersection_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest_intersection_y</span>

            <span class="c1"># append the relative position / and the normalized relative position of the solution on the intersected line</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;relative_position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative_position</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;relative_position_normalized&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">relative_position_normalized</span>

            <span class="c1"># append the underlying map line on which the final point lies AND the oneway_property</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;intersected_line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intersected_line</span>
            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;intersected_line_oneway&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intersected_line_oneway</span>

            <span class="c1"># append the line which visualizes the way from the start point to the new position of the closest intersection point</span>
            <span class="n">linestring_adjustment_visualization</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">focal_pt</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">focal_pt</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="p">(</span><span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">)])</span>

            <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;linestring_adjustment_visualization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linestring_adjustment_visualization</span>

            <span class="c1"># check if previous point is set. if yes: calculate the shortest path from current point to previous point</span>
            <span class="k">if</span><span class="p">(</span><span class="n">previous_point</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
                <span class="c1"># no previous point set, do not calculate shortest path.</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cannot compute shortest path as previous point is (0,0)&#39;</span><span class="p">)</span>
                <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;Cannot compute shortest path as previous point is (0,0). &#39;</span>

                <span class="c1"># update statistics</span>
                <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;cannot_compute_shortest_path_as_previous_point_is_0_0&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">elif</span><span class="p">((</span><span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">)</span> <span class="o">==</span> <span class="n">previous_point</span><span class="p">):</span>
                <span class="c1"># if the taxi did not move, path is not created</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;source==target. Taxi did not move.&#39;</span><span class="p">)</span>

                <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;source==target. Taxi did not move. &#39;</span>

                <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;air_line_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># update statistics</span>
                <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;taxi_did_not_move&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="n">path_time</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">previous_timestamp</span><span class="o">-</span><span class="n">timestamp</span><span class="p">)</span>

                <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_time</span>

                <span class="k">if</span><span class="p">(</span><span class="n">aStar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">path2</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="c1"># calculate the shortest path with A STAR algorithm</span>
                    <span class="n">path</span><span class="p">,</span> <span class="n">path_length</span><span class="p">,</span> <span class="n">pathIDs</span> <span class="o">=</span> <span class="n">getShortestPathAStar</span><span class="p">((</span><span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">),</span> <span class="n">previous_point</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span>
                        <span class="n">intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">previous_intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="n">intersected_line_oneway</span><span class="p">,</span> <span class="n">previous_intersected_line_oneway</span><span class="p">,</span> <span class="n">filepath_shp</span><span class="p">)</span>

                    <span class="c1"># calculate air line distance between source and target</span>
                    <span class="n">air_line_length</span> <span class="o">=</span> <span class="n">distFrom</span><span class="p">(</span>
                        <span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">,</span> <span class="n">previous_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">previous_point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                    <span class="c1"># if this is true, it is possible that a taxi has to ride all around the block because it is a oneway street and source and target lie on the same line</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">air_line_length</span> <span class="o">&lt;</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">intersected_line_oneway</span> <span class="o">!=</span> <span class="s1">&#39;B&#39;</span> <span class="ow">and</span> <span class="n">previous_intersected_line_oneway</span> <span class="o">!=</span> <span class="s1">&#39;B&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">previous_intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">))):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;if statement inside&#39;</span><span class="p">)</span>

                        <span class="c1"># calculate where the source lies on the line</span>
                        <span class="n">d_source</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">))</span><span class="o">.</span><span class="n">project</span><span class="p">(</span>
                            <span class="n">Point</span><span class="p">(</span><span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">))</span>

                        <span class="c1"># calculate where the target lies on the line</span>
                        <span class="n">d_target</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">previous_intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">))</span><span class="o">.</span><span class="n">project</span><span class="p">(</span>
                            <span class="n">Point</span><span class="p">(</span><span class="n">previous_point</span><span class="p">))</span>

                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d_source:&#39;</span><span class="p">,</span> <span class="n">d_source</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;d_target:&#39;</span><span class="p">,</span> <span class="n">d_target</span><span class="p">)</span>

                        <span class="c1"># check if there was a glipse in the gps coordinates which resulted in a situation where the source lies after the target</span>
                        <span class="c1"># if it is a oneway line from the FROM-node to the TO-node and source lies AFTER the target   OR   if it is a oneway line from the TO-node to the FROM-node and source lies BEFORE the target</span>
                        <span class="k">if</span><span class="p">((</span><span class="n">intersected_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span> <span class="ow">and</span> <span class="n">d_source</span> <span class="o">&gt;</span> <span class="n">d_target</span><span class="p">)</span><span class="ow">or</span><span class="p">(</span><span class="n">intersected_line_oneway</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span> <span class="ow">and</span> <span class="n">d_source</span> <span class="o">&lt;</span> <span class="n">d_target</span><span class="p">)):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;if statement inside SECOND!!!&#39;</span><span class="p">)</span>

                            <span class="c1"># calculate the shortest path with A STAR algorithm</span>
                            <span class="c1"># set ignore_oneway=True : this makes sure that the source_line and the target_line both are treated as lines where driving in both directions is allowed (so feature &#39;oneway&#39; is ignored)</span>
                            <span class="n">path2</span><span class="p">,</span> <span class="n">path_length2</span><span class="p">,</span> <span class="n">pathIDs2</span> <span class="o">=</span> <span class="n">getShortestPathAStar</span><span class="p">((</span><span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">),</span> <span class="n">previous_point</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span>
                                <span class="n">previous_intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="n">intersected_line_oneway</span><span class="p">,</span> <span class="n">previous_intersected_line_oneway</span><span class="p">,</span> <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">ignore_oneway</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path_length:&#39;</span><span class="p">,</span> <span class="n">path_length</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path_length2:&#39;</span><span class="p">,</span> <span class="n">path_length2</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path:&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path2:&#39;</span><span class="p">,</span> <span class="n">path2</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check if path2 is better:&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path2</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.. or ..&#39;</span><span class="p">)</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">path</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path2</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="n">path_length</span> <span class="o">&gt;</span> <span class="n">path_length2</span><span class="p">))</span>

                        <span class="c1"># override path/path_lenght/pathIDs to make sure to use the solution which ignores the &#39;oneway&#39; property</span>
                        <span class="k">if</span><span class="p">((</span><span class="n">path</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path2</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">path</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">path2</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">path_length</span> <span class="o">&gt;</span> <span class="n">path_length2</span><span class="p">))):</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OVERRIDING THE PATH&#39;</span><span class="p">)</span>
                            <span class="n">path</span> <span class="o">=</span> <span class="n">path2</span>
                            <span class="n">path_length</span> <span class="o">=</span> <span class="n">path_length2</span>
                            <span class="n">pathIDs</span> <span class="o">=</span> <span class="n">pathIDs2</span>
                            <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;The oneway-property was ignored. &#39;</span>
                            <span class="n">path_from_target_to_source</span> <span class="o">=</span> <span class="mi">1</span>

                            <span class="c1"># update statistics</span>
                            <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;path_from_target_to_source&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                    <span class="c1"># if a path was found, append the solution to the calculatedSolution</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">path</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">velocity_m_s</span> <span class="o">=</span> <span class="n">path_length</span><span class="o">/</span><span class="n">path_time</span>

                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">LineString</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_length</span>
                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;air_line_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">air_line_length</span>
                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_length</span> <span class="o">/</span> \
                            <span class="n">air_line_length</span>
                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">velocity_m_s</span>
                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;pathIDs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pathIDs</span>
                        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>

                    <span class="k">else</span><span class="p">:</span>

                        <span class="c1"># no previous point set, do not calculate shortest path.</span>
                        <span class="n">comment</span> <span class="o">+=</span> <span class="s1">&#39;No path was found with A Star algorithm. &#39;</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No path was found with A Star algorithm.&#39;</span><span class="p">)</span>

        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_from_target_to_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_from_target_to_source</span>
        <span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>

        <span class="k">return</span> <span class="n">location_result</span><span class="p">,</span> <span class="p">(</span><span class="n">closest_intersection_x</span><span class="p">,</span> <span class="n">closest_intersection_y</span><span class="p">),</span> <span class="n">previous_point</span><span class="p">,</span> <span class="n">intersected_line</span><span class="p">,</span> <span class="n">previous_intersected_line</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">intersected_line_oneway</span><span class="p">,</span> <span class="n">previous_intersected_line_oneway</span>

    <span class="c1"># calculate the number of lines of the file we are looking at</span>
    <span class="c1"># lines_in_textfile=sum(1 for line in open(filepath))</span>
    <span class="n">lines_in_textfile</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines_in_textfile</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">lines_in_textfile</span><span class="p">)</span>

    <span class="c1"># Initial call to print 0% progress ProgressBar</span>
    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;| current file: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> lines&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">lines_in_textfile</span><span class="p">)</span>
    <span class="n">printProgressBar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">lines_in_textfile</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Progress:&#39;</span><span class="p">,</span>
                     <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">previous_location_result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">mylist</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="c1"># append an artificaial line at the end. This will make sure that also the path from the last to the second-last element will be calculated and possible improvements will be checked.</span>
        <span class="n">mylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;artificialline&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>

            <span class="c1"># the last line of the text file is artificial as it was added before. this line is just needed to make sure the second last line (which is actually the last actual line of the text file is calculated correctly)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">lines</span> <span class="o">!=</span> <span class="s1">&#39;artificialline&#39;</span><span class="p">):</span>

                <span class="n">values</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="c1"># the longitude and latitude were read from the txt file an saved as a string, here we transform it to a float</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">passenger</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

                <span class="c1"># get the result for the current location</span>
                <span class="n">current_location_result</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">intersected_line</span><span class="p">,</span> <span class="n">target_intersected_line</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">intersected_line_oneway</span><span class="p">,</span> <span class="n">target_intersected_line_oneway</span> <span class="o">=</span> <span class="n">getLocationResult</span><span class="p">(</span>
                    <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">passenger</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">previous_source</span><span class="p">,</span> <span class="n">previous_intersected_line</span><span class="p">,</span> <span class="n">previous_timestamp</span><span class="p">,</span> <span class="n">previous_intersected_line_oneway</span><span class="p">,</span> <span class="n">minNumberOfLines</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lets check previous_target:&#39;</span><span class="p">,</span> <span class="n">previous_target</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lets check target:&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lets check previous_target2:&#39;</span><span class="p">,</span> <span class="n">previous_target</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">previous_location_result</span> <span class="o">!=</span> <span class="p">{}):</span>

                <span class="c1"># check if the result of the previous location can be improved</span>
                <span class="c1"># we check if either velocity&gt;35m/s or if path_length/air_line_length &gt; 2</span>

                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="c1"># TODO: check why it crashes if previous_location_result[&#39;path&#39;]!=&#39;&#39; is removed</span>
                <span class="c1"># TODO: why was there no path found???</span>
                <span class="k">if</span><span class="p">(</span><span class="n">previous_target</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>

                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s1">&#39;previous_location_result[velocity_m_s]:&#39;</span><span class="p">,</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_location_result[path_length/air_line_length]:&#39;</span><span class="p">,</span>
                          <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CHECK1 OTHER SOLUTION???? because PATH=NONE&#39;</span><span class="p">,</span>
                          <span class="p">(</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CHECK2 OTHER SOLUTION???? because PREVIOUS velocity or length to big&#39;</span><span class="p">,</span> <span class="p">((</span><span class="nb">float</span><span class="p">(</span>
                        <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">35.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">)))</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s1">&#39;current_location_result[velocity_m_s]:&#39;</span><span class="p">,</span> <span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">])</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CHECK3 OTHER SOLUTION???? because CURRENT velocity or length to big&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="p">(</span>
                        <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">35.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">))))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                    <span class="c1"># check if either the path from current source to target or from previous source to previous target might be needed to improved</span>
                    <span class="c1"># if (current_location_result[&#39;velocity_m_s&#39;]=&#39;&#39;) means that the taxi was not moving at the previous point --&gt; for this reason it should not be checked</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="p">((</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">35.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">35.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">))):</span>

                        <span class="c1"># update statistics</span>
                        <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;checked_other_solution_index&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OKAY: previous_target is known&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;source:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target:&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_target&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">previous_target</span><span class="p">))</span>

                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s1">&#39;LETS calculate shortest path between current source and previous target&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                        <span class="c1"># check if there is another possible solution</span>
                        <span class="c1"># first calculate shortest path between current source and previous target</span>
                        <span class="n">path_to_previous_target</span><span class="p">,</span> <span class="n">path_length_to_previous_target</span><span class="p">,</span> <span class="n">pathIDs_to_previous_target</span> <span class="o">=</span> <span class="n">getShortestPathAStar</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">previous_target</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span>
                            <span class="n">intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">previous_target_intersected_line</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span> <span class="n">intersected_line_oneway</span><span class="p">,</span> <span class="n">previous_target_intersected_line_oneway</span><span class="p">,</span> <span class="n">filepath_shp</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path_to_previous_target:&#39;</span><span class="p">,</span>
                              <span class="nb">str</span><span class="p">(</span><span class="n">path_to_previous_target</span><span class="p">))</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;path_length_to_previous_target:&#39;</span><span class="p">,</span>
                              <span class="n">path_length_to_previous_target</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pathIDs_to_previous_target:&#39;</span><span class="p">,</span>
                              <span class="n">pathIDs_to_previous_target</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;all_solutions_sorted:&#39;</span><span class="p">,</span>
                              <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;all_solutions_sorted&#39;</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;solution_id:&#39;</span><span class="p">,</span>
                              <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">])</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;solution:&#39;</span><span class="p">,</span>
                              <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution&#39;</span><span class="p">])</span>

                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FOR LOOP:&#39;</span><span class="p">)</span>

                        <span class="k">if</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">pathIDs_to_previous_target</span> <span class="ow">or</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">pathIDs_to_previous_target</span><span class="p">):</span>
                            <span class="nb">print</span><span class="p">(</span>
                                <span class="s1">&#39;Solution is already on the shortest path between the points before and after --&gt; therefore the solution can not be improved.&#39;</span><span class="p">)</span>

                            <span class="c1"># update statistics</span>
                            <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;solution_already_lies_on_shortest_path&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trying to find solution on shortest path.&#39;</span><span class="p">)</span>

                            <span class="n">new_solution_id</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">new_solution_index</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">new_solution</span> <span class="o">=</span> <span class="p">{}</span>

                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;all_solutions_sorted&#39;</span><span class="p">]:</span>
                                <span class="k">if</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pathIDs_to_previous_target</span><span class="p">):</span>
                                    <span class="n">new_solution_id</span> <span class="o">=</span> <span class="n">k</span>
                                    <span class="n">new_solution</span> <span class="o">=</span> <span class="n">v</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;now break&#39;</span><span class="p">)</span>
                                    <span class="k">break</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;k:&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v:&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                                <span class="n">new_solution_index</span> <span class="o">+=</span> <span class="mi">1</span>

                            <span class="k">if</span> <span class="p">(</span><span class="n">new_solution_id</span> <span class="o">==</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                                <span class="nb">print</span><span class="p">(</span>
                                    <span class="s1">&#39;There is no other solution which lies on the shortest path.&#39;</span><span class="p">)</span>

                                <span class="c1"># update statistics</span>
                                <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;no_solution_lies_on_shortest_path&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># check if this solution is actually better</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Check if this solution is actually better.&#39;</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found new_solution_id:&#39;</span><span class="p">,</span> <span class="n">new_solution_id</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;found new_solution:&#39;</span><span class="p">,</span> <span class="n">new_solution</span><span class="p">)</span>
                                <span class="n">previous_commulated_path_lengt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                    <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">])</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_commulated_path_lengt&#39;</span><span class="p">,</span>
                                      <span class="n">previous_commulated_path_lengt</span><span class="p">)</span>

                                <span class="n">new_solution_point_x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                    <span class="n">new_solution</span><span class="p">[</span><span class="s1">&#39;closest_point_on_line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="n">new_solution_point_y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                                    <span class="n">new_solution</span><span class="p">[</span><span class="s1">&#39;closest_point_on_line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new_solution_point_x:&#39;</span><span class="p">,</span>
                                      <span class="n">new_solution_point_x</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new_solution_point_y:&#39;</span><span class="p">,</span>
                                      <span class="n">new_solution_point_y</span><span class="p">)</span>

                                <span class="n">current_location_result_new</span><span class="p">,</span> <span class="n">source_new</span><span class="p">,</span> <span class="n">target_new</span><span class="p">,</span> <span class="n">intersected_line_new</span><span class="p">,</span> <span class="n">target_intersected_line_new</span><span class="p">,</span> <span class="n">timestamp_new</span><span class="p">,</span> <span class="n">intersected_line_oneway_new</span><span class="p">,</span> <span class="n">target_intersected_line_oneway_new</span> <span class="o">=</span> <span class="n">getLocationResult</span><span class="p">(</span>
                                    <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">passenger</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="p">(</span><span class="n">new_solution_point_x</span><span class="p">,</span> <span class="n">new_solution_point_y</span><span class="p">),</span> <span class="n">new_solution</span><span class="p">[</span><span class="s1">&#39;input_line&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">new_solution</span><span class="p">[</span><span class="s1">&#39;oneway&#39;</span><span class="p">],</span> <span class="n">minNumberOfLines</span><span class="p">)</span>

                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current_location_result_new:&#39;</span><span class="p">,</span>
                                      <span class="n">current_location_result_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current_location_result_new -- PATH:&#39;</span><span class="p">,</span>
                                      <span class="nb">str</span><span class="p">(</span><span class="n">current_location_result_new</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;source_new:&#39;</span><span class="p">,</span> <span class="n">source_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target_new:&#39;</span><span class="p">,</span> <span class="n">target_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;intersected_line_new:&#39;</span><span class="p">,</span>
                                      <span class="n">intersected_line_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target_intersected_line_new:&#39;</span><span class="p">,</span>
                                      <span class="n">target_intersected_line_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;timestamp_new:&#39;</span><span class="p">,</span> <span class="n">timestamp_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;intersected_line_oneway_new:&#39;</span><span class="p">,</span>
                                      <span class="n">intersected_line_oneway_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;target_intersected_line_oneway_new:&#39;</span><span class="p">,</span>
                                      <span class="n">target_intersected_line_oneway_new</span><span class="p">)</span>

                                <span class="n">previous_location_result_new</span><span class="p">,</span> <span class="n">previous_source_new</span><span class="p">,</span> <span class="n">previous_target_new</span><span class="p">,</span> <span class="n">previous_intersected_line_new</span><span class="p">,</span> <span class="n">previous_target_intersected_line_new</span><span class="p">,</span> <span class="n">previous_timestamp_new</span><span class="p">,</span> <span class="n">previous_intersected_line_oneway_new</span><span class="p">,</span> <span class="n">previous_target_intersected_line_oneway_new</span> <span class="o">=</span> <span class="n">getLocationResult</span><span class="p">(</span>
                                    <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">new_solution_point_x</span><span class="p">,</span> <span class="n">new_solution_point_y</span><span class="p">,</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;passenger&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;previous_intersected_line&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;previous_timestamp&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;previous_intersected_line_oneway&#39;</span><span class="p">],</span> <span class="n">minNumberOfLines</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_location_result_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_location_result_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_location_result_new -- PATH:&#39;</span><span class="p">,</span>
                                      <span class="nb">str</span><span class="p">(</span><span class="n">previous_location_result_new</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]))</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_source_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_source_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_target_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_target_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_intersected_line_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_intersected_line_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_target_intersected_line_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_target_intersected_line_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_timestamp_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_timestamp_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_intersected_line_oneway_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_intersected_line_oneway_new</span><span class="p">)</span>
                                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_target_intersected_line_oneway_new:&#39;</span><span class="p">,</span>
                                      <span class="n">previous_target_intersected_line_oneway_new</span><span class="p">)</span>

                                <span class="k">if</span><span class="p">(</span><span class="n">previous_location_result_new</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">current_location_result_new</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>

                                    <span class="n">new_commulated_path_lengt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
                                        <span class="n">previous_location_result_new</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">current_location_result_new</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">])</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_commulated_path_lengt:&#39;</span><span class="p">,</span>
                                          <span class="n">previous_commulated_path_lengt</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new_commulated_path_lengt:&#39;</span><span class="p">,</span>
                                          <span class="n">new_commulated_path_lengt</span><span class="p">)</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;is the new solution better???&#39;</span><span class="p">,</span> <span class="p">(</span>
                                        <span class="n">previous_commulated_path_lengt</span> <span class="o">&gt;</span> <span class="n">new_commulated_path_lengt</span><span class="p">))</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                                    <span class="c1"># if the new cummulated path is shorter set it as the correct one</span>
                                    <span class="k">if</span><span class="p">((</span><span class="n">previous_commulated_path_lengt</span> <span class="o">&gt;</span> <span class="n">new_commulated_path_lengt</span><span class="p">)):</span>
                                        <span class="nb">print</span><span class="p">(</span>
                                            <span class="s1">&#39;previous_location_result[solution_id]&#39;</span><span class="p">,</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">])</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;new_solution_id:&#39;</span><span class="p">,</span>
                                              <span class="n">new_solution_id</span><span class="p">)</span>

                                        <span class="n">print_str</span> <span class="o">=</span> <span class="s1">&#39;Set the second checked solution (with solution_id: </span><span class="si">{}</span><span class="s1">) as the correct one since the new cummulated path was shorter than the initial solution (with solution_id: </span><span class="si">{}</span><span class="s1">). &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">new_solution_id</span><span class="p">,</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">])</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="n">print_str</span><span class="p">)</span>
                                        <span class="n">new_comment</span> <span class="o">=</span> <span class="s1">&#39;The source point of this path was reset as this leads to much shorter path lengths. Previous solution: </span><span class="si">{}</span><span class="s1"> / New solution: </span><span class="si">{}</span><span class="s1">. &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">previous_source</span><span class="p">,</span> <span class="p">(</span><span class="n">new_solution_point_x</span><span class="p">,</span> <span class="n">new_solution_point_y</span><span class="p">))</span>

                                        <span class="n">previous_location_result</span> <span class="o">=</span> <span class="n">previous_location_result_new</span>
                                        <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_comment</span>
                                        <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_solution_id</span>
                                        <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_solution_index</span>

                                        <span class="n">current_location_result</span> <span class="o">=</span> <span class="n">current_location_result_new</span>
                                        <span class="n">current_location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;The target point of this path was reset as this leads to much shorter path lengths.&#39;</span>

                                        <span class="c1"># update statistics</span>
                                        <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;chose_other_solution_index&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">new_comment</span> <span class="o">=</span> <span class="s1">&#39;Checked the second solution (solution_id: </span><span class="si">{}</span><span class="s1"> / solution_index: </span><span class="si">{}</span><span class="s1"> / new cummulated path_length: </span><span class="si">{}</span><span class="s1">) initial solution (solution_id: </span><span class="si">{}</span><span class="s1"> / solution_index: </span><span class="si">{}</span><span class="s1"> / initial cummulated path_length: </span><span class="si">{}</span><span class="s1">) was chosen due to a shorter cummulated path_length.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                            <span class="n">new_solution_id</span><span class="p">,</span> <span class="n">new_solution_index</span><span class="p">,</span> <span class="n">new_commulated_path_lengt</span><span class="p">,</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">],</span> <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;solution_index&#39;</span><span class="p">],</span> <span class="n">previous_commulated_path_lengt</span><span class="p">)</span>
                                        <span class="nb">print</span><span class="p">(</span><span class="n">new_comment</span><span class="p">)</span>
                                        <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_comment</span>

                                        <span class="c1"># update statistics</span>
                                        <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;other_solution_is_worse&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                                <span class="k">else</span><span class="p">:</span>
                                    <span class="c1"># no path was found with new solution</span>
                                    <span class="n">new_comment</span> <span class="o">=</span> <span class="s1">&#39;No path found for new solution. &#39;</span>
                                    <span class="nb">print</span><span class="p">(</span><span class="n">new_comment</span><span class="p">)</span>
                                    <span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_comment</span>

                                    <span class="c1"># update statistics</span>
                                    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;other_solution_no_path_found&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Tried to check other solution but the target is not known. &#39;</span><span class="p">)</span>

                <span class="c1"># append the result of the previous location to the entire solution</span>
                <span class="n">calculatedSolution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">previous_location_result</span><span class="p">)</span>

                <span class="c1"># check if a path was found xxx</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">previous_location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                    <span class="c1"># update statistics</span>
                    <span class="n">statistics</span><span class="p">[</span><span class="s1">&#39;no_path_found&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># set the result of the current location as the result of the previous location</span>
            <span class="n">previous_location_result</span> <span class="o">=</span> <span class="n">current_location_result</span>

            <span class="n">previous_source</span> <span class="o">=</span> <span class="n">source</span>
            <span class="n">previous_target</span> <span class="o">=</span> <span class="n">target</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_source&#39;</span><span class="p">,</span> <span class="n">previous_source</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;previous_target&#39;</span><span class="p">,</span> <span class="n">previous_target</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="n">previous_intersected_line</span> <span class="o">=</span> <span class="n">intersected_line</span>
            <span class="n">previous_target_intersected_line</span> <span class="o">=</span> <span class="n">target_intersected_line</span>
            <span class="n">previous_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span>
            <span class="n">previous_intersected_line_oneway</span> <span class="o">=</span> <span class="n">intersected_line_oneway</span>
            <span class="n">previous_target_intersected_line_oneway</span> <span class="o">=</span> <span class="n">target_intersected_line_oneway</span>

            <span class="c1"># TODO: Delete the following lines as this is just for testing.</span>
            <span class="c1"># stop script after a few lines (for testing reasons)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ende&#39;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="c1"># Update Progress Bar</span>

            <span class="c1"># enablePrint()</span>

            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;| current file: </span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1"> lines&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">counter</span><span class="p">,</span> <span class="n">lines_in_textfile</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">suffix</span> <span class="o">+=</span> <span class="s1">&#39; | total: </span><span class="si">{}</span><span class="s1"> of </span><span class="si">{}</span><span class="s1"> files&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">counter</span><span class="p">,</span> <span class="n">lines_in_textfile</span><span class="p">)</span>
            <span class="n">printProgressBar</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">lines_in_textfile</span><span class="p">,</span>
                             <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;Progress:&#39;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

            <span class="c1"># blockPrint()</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        NOT NEEDED ANYMORE, as we have artificial line now</span>

<span class="sd">        # the result of a location is only added to the intire solution after it is confirmed as the best solution by the next location</span>
<span class="sd">        # for this reason the result of the last location of the text_file has to be added to the entire solution (since there isn&#39;t a next solution that will do that)</span>
<span class="sd">        calculatedSolution.append(previous_location_result)</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">calculatedSolution</span><span class="p">,</span> <span class="n">statistics</span></div>


<span class="k">def</span> <span class="nf">getTimeDifferences</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">timestampPosition</span><span class="p">):</span>

    <span class="c1"># initialise empty list</span>
    <span class="n">timeDifferences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># set previousTimestamp to 0</span>
    <span class="n">previousTimestamp</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># open the file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">mylist</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

        <span class="c1"># loop through the txt file</span>
        <span class="k">for</span> <span class="n">lines</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="c1"># get the timestamp of the current line</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">timestampPosition</span><span class="p">])</span>

            <span class="c1"># if it&#39;t not the forst entry of the txt file, append the difference to the set</span>
            <span class="k">if</span><span class="p">(</span><span class="n">previousTimestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">timeDifferences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">previousTimestamp</span><span class="o">-</span><span class="n">timestamp</span><span class="p">)</span>

            <span class="n">previousTimestamp</span> <span class="o">=</span> <span class="n">timestamp</span>

    <span class="k">return</span> <span class="n">timeDifferences</span>


<span class="k">def</span> <span class="nf">plotAndSaveHistogram</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">minXLabel</span><span class="p">,</span> <span class="n">maxXLabel</span><span class="p">,</span> <span class="n">binSize</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">):</span>
    <span class="c1"># get the max value of the imputs</span>
    <span class="n">maxInput</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>

    <span class="c1"># check if inputs are floats (as in the case of velocities)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">maxInput</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="c1"># round the float to the next higher number and then convert it to int</span>
        <span class="n">maxInput</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">maxInput</span><span class="p">))</span>

    <span class="c1"># create the bins (as a range from 0 to maxXLabel or maxInput depending on which one is smaller). +2 is needed to display also the max number.</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binSize</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="c1"># create a range with floats</span>
        <span class="n">myBins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">minXLabel</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span>
            <span class="n">maxXLabel</span><span class="p">,</span> <span class="n">maxInput</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">binSize</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">binSize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># create a range with ints</span>
        <span class="n">myBins</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">minXLabel</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">maxXLabel</span><span class="p">,</span> <span class="n">maxInput</span><span class="p">)</span> <span class="o">+</span>
                       <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">binSize</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="n">binSize</span><span class="p">)</span>

    <span class="c1"># initialize the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># plot the histogram. &#39;np.clip&#39; makes sure that the time differences which are bigger then the max X value are visualized in the last bin.</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="nb">input</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">myBins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">bins</span><span class="o">=</span><span class="n">myBins</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0504aa&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">maxfreq</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="c1"># Set a clean upper y-axis limit.</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">maxfreq</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">maxfreq</span> <span class="o">%</span> <span class="mi">10</span> <span class="k">else</span> <span class="n">maxfreq</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binSize</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">xlabels</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;|S3&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xlabels</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">:]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="c1"># remove the last x label</span>
    <span class="n">xlabels</span> <span class="o">=</span> <span class="n">xlabels</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># add a &#39;+&#39; to the label of the last bin to visualize that this bin contains all timeDifferences  which are equal or bigger than the xTick.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">binSize</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="n">xlabels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;+&#39;</span>

    <span class="n">myXTicks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">myBins</span><span class="p">)</span>
    <span class="c1"># set the x ticks for the figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">myXTicks</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">)</span>

    <span class="c1"># save the figure in the folder of the current taxi</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># plt.show()</span>
    <span class="c1"># close the current figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># %%</span>


<div class="viewcode-block" id="getFilename"><a class="viewcode-back" href="../index.html#gps2net.getFilename">[docs]</a><span class="k">def</span> <span class="nf">getFilename</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Returns the name of a file from a specific path (excluding directories and extension).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : [string]</span>
<span class="sd">        The path of a specific data file.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    string</span>
<span class="sd">        The name of the file. Namely, the last part of the path (excluding the extgension).</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; myPath = &#39;dir1/dir2/MyFilename.txt&#39;</span>
<span class="sd">    &gt;&gt;&gt; filename = getFilename(myPath)</span>
<span class="sd">    &gt;&gt;&gt; filename</span>
<span class="sd">    &#39;MyFilename&#39;</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># get the name of the file from the path (without the directories and without extension)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filename</span></div>


<span class="c1"># %%</span>
<span class="c1"># only selected data points from this taxi</span>
<span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/new_abboip_selection_test.txt&#39;</span>
<span class="c1"># all data points from this taxi</span>
<span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_selection_for_SP_tests.txt&#39;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="c1"># blockPrint()</span>

    <span class="k">def</span> <span class="nf">caculationForOneTXTFile</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">aStar</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="c1"># set the header of the output txt file which will contain the calculated solution.</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;latitude(y);longitude(x);hasPassenger;time;closest_intersection_x;closest_intersection_y;relative_position;relative_position_normalized;intersected_line_oneway;intersected_line_as_linestring;linestring_adjustment_visualization;path_time&#39;</span><span class="p">]</span>

        <span class="k">if</span><span class="p">(</span><span class="n">aStar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;;path_as_linestring;path_length;air_line_length;path_length/air_line_length;velocity_m_s;pathIDs;solution_id;solution_index;path_from_target_to_source;comment&#39;</span>

        <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">new_filename_solution</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">dirName</span><span class="p">,</span> <span class="s1">&#39;calculatedSolution&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
        <span class="n">new_filename_statistics</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="s1">&#39;statistics&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span>
        <span class="n">new_filename_velocities</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirName</span><span class="p">,</span> <span class="s1">&#39;velocitiesPLOT.png&#39;</span><span class="p">)</span>
        <span class="n">new_filename_path_length_air_line_length</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">dirName</span><span class="p">,</span> <span class="s1">&#39;path_length_air_line_length_PLOT.png&#39;</span><span class="p">)</span>

        <span class="n">myCalculatedSolution</span><span class="p">,</span> <span class="n">mySolutionStatistics</span> <span class="o">=</span> <span class="n">calculateClosestPointAndShortestPath</span><span class="p">(</span>
            <span class="n">filepath</span><span class="p">,</span> <span class="n">filepath_shp</span><span class="p">,</span> <span class="n">minNumberOfLines</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">aStar</span><span class="o">=</span><span class="n">aStar</span><span class="p">)</span>

        <span class="c1"># this saves a new text file which includes the calculated parameters</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_filename_solution</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
            <span class="c1"># write the header to the new txt file</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

            <span class="c1"># write the calculated solution to the new txt file</span>
            <span class="k">for</span> <span class="n">location_result</span> <span class="ow">in</span> <span class="n">myCalculatedSolution</span><span class="p">:</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;passenger&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;closest_intersection_x&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;closest_intersection_y&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;relative_position&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;relative_position_normalized&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;intersected_line_oneway&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;intersected_line&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;linestring_adjustment_visualization&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_time&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;air_line_length&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;pathIDs&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;solution_id&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;solution_index&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_from_target_to_source&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># initialise empty lists</span>
        <span class="n">velocities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path_length_air_line_length</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">velocities_none_counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># get all velocities of the solution</span>
        <span class="k">for</span> <span class="n">location_result</span> <span class="ow">in</span> <span class="n">myCalculatedSolution</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">velocities_none_counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">velocities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;velocity_m_s&#39;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                <span class="n">path_length_air_line_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">location_result</span><span class="p">[</span><span class="s1">&#39;path_length/air_line_length&#39;</span><span class="p">]))</span>

        <span class="c1"># plot the timeDifferences in a histogram</span>
        <span class="n">plotAndSaveHistogram</span><span class="p">(</span><span class="n">velocities</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">new_filename_velocities</span><span class="p">,</span>
                             <span class="s1">&#39;Histogram of velocities between gps points&#39;</span><span class="p">,</span> <span class="s1">&#39;velocity in m/s&#39;</span><span class="p">)</span>

        <span class="c1"># plot the the path_length/air_line_length in a histogram</span>
        <span class="n">plotAndSaveHistogram</span><span class="p">(</span><span class="n">path_length_air_line_length</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">new_filename_path_length_air_line_length</span><span class="p">,</span>
                             <span class="s1">&#39;Histogram of path lengths divided by air line lengths&#39;</span><span class="p">,</span> <span class="s1">&#39;path length / air line length&#39;</span><span class="p">)</span>

        <span class="c1"># SAVE STATISTICS IN NEW FILE</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_filename_statistics</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">new_file</span><span class="p">:</span>
            <span class="c1"># write statistics to the file</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;path of shp file: &#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">))</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;path of old file: &#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;path of new file: &#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_filename_solution</span><span class="p">))</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># calculate the number of lines in the txt file</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">num_lines</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;number of lines in txt file: &#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">num_lines</span><span class="p">))</span>

            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="c1"># write the statistics whcih were returned from the algorithm to the file</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mySolutionStatistics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;VELOCITIES PLOT: &#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;The Velocity plot contains velocities from </span><span class="si">{}</span><span class="s1"> data points. For the remaining </span><span class="si">{}</span><span class="s1"> data points the velocity could not be calculated (e.g. because it is an outlier).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">num_lines</span><span class="o">-</span><span class="n">velocities_none_counter</span><span class="p">,</span> <span class="n">velocities_none_counter</span><span class="p">))</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">new_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># enablePrint()</span>

    <span class="c1">#filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy.txt&#39;</span>

    <span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_small.txt&#39;</span>
    <span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_small_verysmall.txt&#39;</span>
    <span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_small_verysmall_2.txt&#39;</span>
    <span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_small_verysmall_3.txt&#39;</span>

    <span class="c1"># filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_small_verysmall_4.txt&#39;</span>

    <span class="c1">#filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_verysmall_closestIsBest_oneline.txt&#39;</span>

    <span class="c1">#filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_SMALL_to_check_outlier.txt&#39;</span>

    <span class="c1">##filepath = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/new_abboip_copy_verysmall_closestIsBest_1stSolution.txt&#39;</span>

    <span class="c1">#filepath = &#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/just_one_taxi/new_abboip_copy_check_wrong_outliers.txt&#39;</span>

    <span class="n">filepath1</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/just_one_taxi/new_abboip_copy.txt&#39;</span>
    <span class="n">filepath2</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/other_taxi/new_abgibo_copy.txt&#39;</span>
    <span class="n">filepath3</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/other_taxi/new_abmuyawm_copy.txt&#39;</span>
    <span class="n">filepath4</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/other_taxi/new_abniar_copy.txt&#39;</span>
    <span class="n">filepath5</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/other_taxi/new_abnovkak_copy.txt&#39;</span>
    <span class="n">filepath6</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/other_taxi/new_abtyff_copy.txt&#39;</span>
    <span class="n">filepath7</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/test_data/other_taxi/new_abwecnij_copy.txt&#39;</span>

    <span class="c1">#filepath_shp = &#39;/Users/Joechi/Google Drive/HS19 – PathPy/2_Taxi data/Tests/Exports/AllPointsForOneTaxi/geo_SF_lines_exported_for_testing.shp&#39;</span>

    <span class="n">filepath_shp</span> <span class="o">=</span> <span class="s1">&#39;/Users/Joechi/Google Drive/gps2net/Data/taxi_san_francisco/San Francisco Basemap Street Centerlines/geo_export_e5dd0539-2344-4e87-b198-d50274be8e1d.shp&#39;</span>

    <span class="n">filepaths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath6</span><span class="p">)</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath7</span><span class="p">)</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath1</span><span class="p">)</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath2</span><span class="p">)</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath3</span><span class="p">)</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath4</span><span class="p">)</span>
    <span class="n">filepaths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath5</span><span class="p">)</span>

    <span class="c1"># loop through all the filepaths</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">filepaths</span><span class="p">:</span>

        <span class="n">new_filename</span> <span class="o">=</span> <span class="n">getFilename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="n">dirName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;output_files&#39;</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>

        <span class="c1">#dirName += new_filename</span>

        <span class="c1"># os.makedirs(dirName)</span>

        <span class="c1"># Create target directory &amp; all intermediate directories if don&#39;t exists</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirName</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Directory &#39;</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span>  <span class="s1">&#39; created.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Directory &#39;</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span>  <span class="s1">&#39; already exists.&#39;</span><span class="p">)</span>

        <span class="n">caculationForOneTXTFile</span><span class="p">(</span><span class="n">filepath_shp</span><span class="p">,</span> <span class="n">dirName</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># get all timestamp differences of a text file</span>
        <span class="n">timeDifferences</span> <span class="o">=</span> <span class="n">getTimeDifferences</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">timedifferencesFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">dirName</span><span class="p">,</span> <span class="s1">&#39;timedifferencesPLOT.png&#39;</span><span class="p">)</span>

        <span class="c1"># plot the timeDifferences in a histogram</span>
        <span class="n">plotAndSaveHistogram</span><span class="p">(</span><span class="n">timeDifferences</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">timedifferencesFileName</span><span class="p">,</span>
                             <span class="s1">&#39;Histogram of time differences between gps points&#39;</span><span class="p">,</span> <span class="s1">&#39;time difference in seconds&#39;</span><span class="p">)</span>


<span class="c1"># %%</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="c1"># running &#39;doctest.testmod()&#39; test the examples in docstrings. Alternatively, the examples in docstrings can be tested by navigating to the &#39;docs&#39; directory and running the following command in the terminal: python gps2net.py -v</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>

    <span class="c1"># run the main method</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">gps2net 1.1.2020 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Joachim Baumann.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>